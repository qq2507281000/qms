<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" >
<head>
    <th:block th:include="include :: header('修改商家信息')" />
    <!--<th:block th:include="include :: summernote-css" />-->
    <!--<link href="/qcloud/css/cityLayout.css" type="text/css" rel="stylesheet">-->
    <!--<th:block th:include="include :: jasny-bootstrap-css" />-->
    <!--<link href="https://cdn.bootcss.com/bootstrap-switch/3.3.4/css/bootstrap2/bootstrap-switch.css" rel="stylesheet">-->
    <!--<th:block th:include="include :: bootstrap-fileinput-css" />-->
    <!--<th:block th:include="include :: datetimepicker-css" />-->
    <!--<link href="http://localhost/ajax/libs/datapicker/bootstrap-timepicker.min.css" rel="stylesheet">-->
    <th:block th:include="include :: summernote-css" />
    <th:block th:include="include :: bootstrap-fileinput-css" />
    <th:block th:include="include :: datetimepicker-css" />
    <script th:inline="javascript">
        /*<![CDATA[*/

        var htmlContent = '[[${tShop.htmlContent}]]';
        console.log("------>>>" + htmlContent);

        /*]]>*/
    </script>
</head>
<body class="white-bg">
<div class="wrapper wrapper-content animated fadeInRight ibox-content">
    <form class="form-horizontal m" id="form-shop-edit" th:object="${tShop}">
        <input name="id" th:field="*{id}" type="hidden">
        <h4 class="form-header h4">基本信息</h4>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">商家名称：</label>
                    <div class="col-sm-8">
                        <input name="name" th:field="*{name}" class="form-control" type="text" maxlength="30" required>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">商家副标题：</label>
                    <div class="col-sm-8">
                        <input name="subject" th:field="*{subject}" type="text" class="form-control" required>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">营业时间：</label>
                    <div class="col-sm-8">
                        <input id="times_range" th:field="*{params[times]}" name="params[times]" class="form-control" type="text" maxlength="50" required>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">运营城市：</label>
                    <div class="col-sm-8">
                        <select name="regionName" class="form-control m-b" th:with="type=${@dict.getType('operation_city')}" required>
                            <option th:each="dict : ${type}" th:text="${dict.dictLabel}" th:value="${dict.dictValue}" th:field="*{regionName}"></option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">详细位置：</label>
                    <div class="col-sm-8">
                        <input name="address" class="form-control" th:field="*{address}" type="text" maxlength="100" required placeholder="请输入详细地址...">
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">是否推荐</label>
                    <div class="col-sm-8">
                        <div class="radio-box" th:each="dict : ${@dict.getType('suggest')}">
                            <input type="radio" th:id="${dict.dictCode}" name="suggest" th:value="${dict.dictValue}" th:checked="${dict.default}" th:field="*{suggest}">
                            <label th:for="${dict.dictCode}" th:text="${dict.dictLabel}"></label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="form-group">
                <div class="col-sm-2 text-right">
                    <label class="control-label">封面图片：</label>
                </div>
                <div class="col-sm-10" style="padding-left:25px;padding-right:25px;">
                    <div id="imgUploadPanel">
                        <input id="imgUpload" type="file" />
                        <input id="imgUploadFileId" th:type="hidden" />
                    </div>
                    <input id="img" name="coverImg" type="hidden" th:field="*{coverImg}">
                </div>
            </div>
        </div>

        <h4 class="form-header h4">联系信息</h4>

        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">商家座机：</label>
                    <div class="col-sm-8">
                        <input name="telephone" th:field="*{telephone}" class="form-control" type="text" maxlength="30" required>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">商家手机：</label>
                    <div class="col-sm-8">
                        <input name="mobile" th:field="*{mobile}" type="text" class="form-control" required>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">联系人姓名：</label>
                    <div class="col-sm-8">
                        <input name="contractName" th:field="*{contractName}" class="form-control" type="text" maxlength="30" required>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">个人微信号：</label>
                    <div class="col-sm-8">
                        <input name="wechatNo" th:field="*{wechatNo}" class="form-control" type="text" maxlength="30" required>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label">微信公众平台：</label>
                    <div class="col-sm-8">
                        <input name="wechatPlatform" th:field="*{wechatPlatform}" class="form-control" type="text" maxlength="30" required>
                    </div>
                </div>
            </div>
        </div>

        <h4 class="form-header h4">其他信息</h4>

        <div class="row" style="padding-left:20px;padding-right:20px;">
            <div id="summernote" class="summernote">
            </div>
        </div>

    </form>

    <div class="row">
        <div class="col-sm-offset-5 col-sm-10">
            <button type="button" class="btn btn-sm btn-primary" onclick="submitHandler()"><i class="fa fa-check"></i>保 存</button>&nbsp;
            <button type="button" class="btn btn-sm btn-danger" onclick="closeItem()"><i class="fa fa-reply-all"></i>关 闭 </button>
        </div>
    </div>

</div>
<th:block th:include="include :: footer" />
<!--<th:block th:include="include :: jasny-bootstrap-js" />-->
<!--<script src="https://cdn.bootcss.com/bootstrap-switch/3.3.4/js/bootstrap-switch.js"></script>-->
<th:block th:include="include :: summernote-js" />
<th:block th:include="include :: bootstrap-fileinput-js" />
<th:block th:include="include :: datetimepicker-js" />

<!--<script th:src="@{/ajax/libs/datapicker/bootstrap-datetimepicker.min.js}"></script>-->
<!--<script th:src="@{/ajax/libs/datapicker/bootstrap-datetimepicker.zh-CN.js}"></script>-->

<!--<script th:src="@{/ajax/libs/datapicker/bootstrap-timepicker.min.js}"></script>-->
<script type="text/javascript">
    var prefix = "/shop";
    $("#form-shop-edit").validate({
        focusCleanup: true
    });

    //富文本输入框
    $(document).ready(function () {
        $('.summernote').summernote({
            lang: 'zh-CN',
            placeholder: '请输入商家详细信息。',
            height: 300
        });
        // var htmlContent = "'" + [[${tShop.htmlContent}]] + "'";
        $('.summernote').summernote("code",htmlContent);
    });

    $(function(){
        $("#imgUpload").fileinput({
            // 'theme': 'explorer-fas',
            uploadUrl: '/file/upload',
            overwriteInitial: false,
            initialPreviewAsData: true,
            maxFileCount: 1,
            initialPreview: [
                "/resource-file/" + $('#img').val()
            ]
        });

        $("#imgUpload").on("fileuploaded", function (event, data, previewId, index) {
            // var content = JSON.stringify(data);
            var code = data.response.code;
            var message = data.response.message;
            var list = data.response.data;
            if(code == 0){
                //文件上传成功。
                $.modal.alertSuccess(message);
                var fileName = list[0];
                $("#img").val(fileName);
            }
            else if(code == 500){
                $.modal.alertError(message);
            }
            // console.log(content);
            console.log(code);
            console.log(message);
            console.log(list[0]);
        })
    });

    function submitHandler() {

        var note = $('.summernote').summernote('code');
        // var chtml = $.common.encode(note);
        if($.common.isEmpty($('#img').val())){
            $.modal.alertError("请先上传图片文件。");
            return;
        }

        if ($.validate.form()) {
            // $.operate.save(prefix+"/add", $('#form-shop-add').serialize());
            var data = $("#form-shop-edit").serializeArray();
            // var status = $("input[id='status']").is(':checked') == true ? 0 : 1;
            // var roleIds = $.form.selectCheckeds("role");
            // var postIds = $.form.selectSelects("post");
            // data.push({"name": "status", "value": status});
            // data.push({"name": "roleIds", "value": roleIds});
            // data.push({"name": "postIds", "value": postIds});
            data.push({"name": "htmlContent", "value": note});
            console.log(JSON.stringify(data));
            $.operate.saveTab(prefix + "/edit", data);

        }
    }

    layui.use('laydate', function() {
        var laydate = layui.laydate;
        laydate.render({
            elem: '#times_range'
            ,type: 'time'
            ,range: true
        });
    });

    // 修改时js有bug------------------

    // function openClick(that){
    //     if($(that).attr('checked')){
    //         $(that).removeAttrs('checked');
    //         $(that).parent().find('input').eq(1).val(0);
    //     }else {
    //         $(that).attr('checked','checked');
    //         $(that).parent().find('input').eq(1).val(1);
    //     }
    // }


    //
    // function editCourses() {
    //     if ($.validate.form()) {
    //         var note = $('.summernote').summernote('code');
    //         $.operate.saveHtml(prefix+"/edit",$('#form-shop-edit'),"htmlContent",note);
    //     }
    // }
    // $(function(){
    //     $("#shopHoursBegin").val($("#shopHoursBegin").val()).timepicker('setTime', $("#shopHoursBegin").val());
    //     $("#shopHoursEnd").val($("#shopHoursEnd").val()).timepicker('setTime', $("#shopHoursEnd").val());
    // })
    //
    // $('.summernote').summernote('code',htmlContent);
</script>
</body>
</html>